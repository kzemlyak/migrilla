# ü¶ç Migrilla

–ü—Ä–æ—Å—Ç–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π PostgreSQL –≤ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install migrilla
```

## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã

```bash
migrilla up      # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ–∂–∏–¥–∞—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
migrilla down    # –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
migrilla status  # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
migrilla help    # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
MIGRILLA_DB_HOST=localhost           # –•–æ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
MIGRILLA_DB_PORT=5432               # –ü–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
MIGRILLA_DB_NAME=myapp              # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
MIGRILLA_DB_USER=postgres           # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
MIGRILLA_DB_PASSWORD=mypassword     # –ü–∞—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
MIGRILLA_DATABASE_URL=postgres://user:pass@host:port/db  # –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
MIGRILLA_DB_SSL=true                # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
```

## üíæ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

‚úÖ –ß–∏—Ç–∞–µ—Ç SQL —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `migrations/`  
‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `migrilla_state`  
‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –∫–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å  
‚úÖ –ò–∑—è—â–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  

## ü¶ç –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π –≤ –ø–∞–ø–∫–µ `migrations/`:

### –®–∞–±–ª–æ–Ω –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
```
001_–Ω–∞–∑–≤–∞–Ω–∏–µ_–º–∏–≥—Ä–∞—Ü–∏–∏_up.sql    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
001_–Ω–∞–∑–≤–∞–Ω–∏–µ_–º–∏–≥—Ä–∞—Ü–∏–∏_down.sql  # –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```
migrations/
‚îú‚îÄ‚îÄ 001_add_users_table_up.sql
‚îú‚îÄ‚îÄ 001_add_users_table_down.sql
‚îú‚îÄ‚îÄ 002_add_orders_table_up.sql
‚îú‚îÄ‚îÄ 002_add_orders_table_down.sql
‚îî‚îÄ‚îÄ 003_add_indexes_up.sql
‚îî‚îÄ‚îÄ 003_add_indexes_down.sql
```

## üìö –ü—Ä–∏–º–µ—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–π

**001_add_users_table_up.sql**
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**001_add_users_table_down.sql**
```sql
DROP TABLE IF EXISTS users;
```

## üîß –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```javascript
const createMigrilla = require('migrilla');

const migrilla = createMigrilla({
  host: 'localhost',
  port: 5432,
  database: 'myapp',
  user: 'postgres',
  password: 'password'
});

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
await migrilla.up();

// –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
await migrilla.down();

// –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
await migrilla.status();

// –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
await migrilla.close();
```

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
```javascript
await migrilla.executeInTransaction(async (client) => {
  await client.query('INSERT INTO users (name) VALUES ($1)', ['–ò–≤–∞–Ω']);
  await client.query('UPDATE stats SET count = count + 1');
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

Migrilla –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∞—Ç–æ–º–∞—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** –º–∏–≥—Ä–∞—Ü–∏–π:

- –ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
- –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–æ—Ç–∫–∞—Ç** –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ù–∏–∫–∞–∫–∏—Ö —á–∞—Å—Ç–∏—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –∏–ª–∏ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm test         # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
```

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18.0.0 –∏–ª–∏ –Ω–æ–≤–µ–µ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π –≤ –ø–∞–ø–∫–µ `migrations/`

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –∫–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –æ—Ç–∫–∞—Ç–æ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–£–º–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ SQL —Ñ–∞–π–ª–æ–≤
- **–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - –≤ —Ç–∞–±–ª–∏—Ü–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–ö—Ä–∞—Å–∏–≤—ã–π CLI** - —Å —ç–º–æ–¥–∑–∏ –∏ —Ü–≤–µ—Ç–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π API** - –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ
- **–§–æ–∫—É—Å –Ω–∞ PostgreSQL** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è PostgreSQL

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [README.md](README.md) - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (English)
- [README_RU.md](README_RU.md) - –î–∞–Ω–Ω—ã–π —Ñ–∞–π–ª (—Ä—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è)
- [FEATURES.md](FEATURES.md) - –û–±–∑–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- [API_REFERENCE.md](API_REFERENCE.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [TRANSACTION_GUIDE.md](TRANSACTION_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º
- [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [CHANGELOG.md](CHANGELOG.md) - –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –≤–µ—Ä—Å–∏–π
- [SUMMARY.md](SUMMARY.md) - –ò—Ç–æ–≥–æ–≤—ã–π –æ–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–í–æ–ø—Ä–æ—Å—ã –∏ pull request'—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT 